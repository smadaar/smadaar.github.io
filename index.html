<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Consistent Hash Checker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    textarea, input { width: 100%; margin-bottom: 10px; padding: 8px; font-size: 14px; }
    button { padding: 10px 20px; font-size: 16px; }
    #result { font-size: 18px; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Consistent Hash Key Mapping</h2>

  <label>Nodes (one per line):</label>
  <textarea id="nodes" rows="6" placeholder="nodeA&#10;nodeB&#10;nodeC"></textarea>

  <label>Target Node (to check if selected):</label>
  <input type="text" id="targetNode" placeholder="e.g., nodeB" />

  <label>Key to Hash (e.g., user123):</label>
  <input type="text" id="keyToHash" placeholder="e.g., user123" />

  <label>Salt:</label>
  <input type="text" id="salt" placeholder="Optional salt" />

  <button onclick="checkConsistentHash()">Check</button>

  <div id="result"></div>

  <script>
    async function sha1Hex(str) {
      const buffer = new TextEncoder().encode(str);
      const hash = await crypto.subtle.digest("SHA-1", buffer);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function buildHashRing(nodes, salt) {
      const ring = [];
      for (const node of nodes) {
        const hash = await sha1Hex(salt + node);
        ring.push({ node, hash });
      }
      ring.sort((a, b) => a.hash.localeCompare(b.hash));
      return ring;
    }

    async function getNodeForKey(ring, key, salt) {
      const keyHash = await sha1Hex(salt + key);
      for (const entry of ring) {
        if (keyHash <= entry.hash) return entry.node;
      }
      // wrap around
      return ring[0].node;
    }

    async function checkConsistentHash() {
      const nodeLines = document.getElementById("nodes").value.trim().split("\n").map(v => v.trim()).filter(Boolean);
      const targetNode = document.getElementById("targetNode").value.trim();
      const keyToHash = document.getElementById("keyToHash").value.trim();
      const salt = document.getElementById("salt").value.trim();

      if (!nodeLines.length || !targetNode || !keyToHash) {
        document.getElementById("result").innerText = "Please fill in all required fields.";
        return;
      }

      const ring = await buildHashRing(nodeLines, salt);
      const assignedNode = await getNodeForKey(ring, keyToHash, salt);

      const result = assignedNode === targetNode;
      document.getElementById("result").innerText = `Key maps to: ${assignedNode}\nMatch: ${result ? "✅ True" : "❌ False"}`;
    }
  </script>
</body>
</html>
